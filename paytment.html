<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cabinet of Selves – Secure Payment</title>

  <!-- Brand fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #0B1B1C;         /* deep midnight */
      --card:#0F2124;
      --heading:#F5F4F2;
      --text:#C8CDD0;
      --accent:#D5A5C9;      /* soft mythic pink   */
      --accent-dark:#C48BB9;
      --radius:12px;
      --shadow:0 8px 22px rgba(0,0,0,.45);
    }

    html,body{
      margin:0;
      height:100%;
      background:var(--bg);
      color:var(--text);
      font-family:Inter,system-ui,"Segoe UI",sans-serif;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:48px 24px;
    }

    h1{
      font-family:"Playfair Display",serif;
      color:var(--heading);
      font-size:2rem;
      margin:0 0 12px;
      text-align:center;
    }
    p{font-size:1rem;margin:0 0 32px;text-align:center}

    #pay-button{
      background:var(--accent);
      color:#0B1B1C;
      border:none;
      border-radius:var(--radius);
      padding:16px 36px;
      font-size:1.1rem;
      font-weight:600;
      cursor:pointer;
      transition:.25s all;
      box-shadow:var(--shadow);
    }
    #pay-button:hover{background:var(--accent-dark);transform:translateY(-2px)}
    #paytr-iframe{
      margin-top:36px;
      width:100%;
      max-width:820px;
      height:620px;
      border:none;
      border-radius:var(--radius);
      display:none;
      box-shadow:var(--shadow);
    }
    #status{margin-top:24px;font-size:.95rem;color:var(--text)}

    /* Simple loader */
    .loader{
      border:4px solid rgba(255,255,255,.15);
      border-top:4px solid var(--accent);
      border-radius:50%;
      width:28px;height:28px;
      animation:spin .9s linear infinite;
      display:inline-block;margin-right:10px;vertical-align:middle;
    }
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
  </style>
</head>
<body>

  <h1>Complete Your $9.99 Purchase</h1>
  <p>Click the button below to open a secure PayTR checkout for <em>Cabinet of Selves</em>.</p>

  <button id="pay-button">💳 Pay $9.99</button>

  <div id="status"></div>
  <iframe id="paytr-iframe" title="Secure PayTR Checkout"></iframe>

  <script>
    const payButton = document.getElementById("pay-button");
    const iframe    = document.getElementById("paytr-iframe");
    const status    = document.getElementById("status");

    payButton.addEventListener("click", async () => {
      iframe.style.display = "none";
      status.innerHTML =
        '<span class="loader"></span>Requesting secure payment link...';

      try {
        const response = await fetch(
          "https://paymentintegration-production-a10d.up.railway.app/paytr-init",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              email:       "test@tempestlabs.space",
              price:       "9.99",                   // <-- updated price
              user_name:   "Ilke",
              user_address:"Imaginary Street No. 42, Istanbul",
              user_phone:  "05555555555"
            })
          }
        );

        const data = await response.json();

        if (data.token_url) {
          iframe.src = data.token_url;
          iframe.style.display = "block";
          status.textContent =
            "✅ Secure payment loaded. Please complete your transaction below.";
        } else {
          status.textContent = "⚠️ Failed to generate payment link.";
          console.error("Error response:", data);
        }
      } catch (err) {
        status.textContent = "🚨 Error: " + err.message;
        console.error("Request error:", err);
      }
    });
  </script>

</body>
</html>
