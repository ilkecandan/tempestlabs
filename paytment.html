<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cabinet of Selves â€“ Secure Payment</title>

  <!-- Brand fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #0B1B1C;
      --card: #0F2124;
      --heading: #F5F4F2;
      --text: #C8CDD0;
      --accent: #D5A5C9;
      --accent-dark: #C48BB9;
      --radius: 12px;
      --shadow: 0 8px 22px rgba(0,0,0,0.45);
    }

    html, body {
      margin: 0;
      padding: 48px 24px;
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', system-ui, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      min-height: 100vh;
    }

    input {
      width: 100%;
      max-width: 400px;
      padding: 12px;
      margin-bottom: 12px;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
    }

    img.hero-image {
      width: 160px;
      height: auto;
      margin-bottom: 24px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    h1 {
      font-family: "Playfair Display", serif;
      color: var(--heading);
      font-size: 2.5rem;
      margin: 12px 0 24px;
    }

    p {
      font-size: 1.1rem;
      max-width: 700px;
      margin-bottom: 24px;
      line-height: 1.6;
    }

    .exchange-note {
      font-size: 0.9rem;
      color: #aaa;
      margin-bottom: 24px;
      max-width: 480px;
    }

    #pay-button,
    .link-button {
      background: var(--accent);
      color: var(--bg);
      border: none;
      border-radius: var(--radius);
      padding: 16px 36px;
      font-size: 1.15rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: 0.3s all;
      margin-bottom: 16px;
    }

    .link-button {
      background: var(--accent-dark);
    }

    #pay-button:hover,
    .link-button:hover {
      transform: translateY(-2px);
      opacity: 0.9;
    }

    #paytr-iframe {
      margin-top: 36px;
      width: 100%;
      max-width: 820px;
      height: 620px;
      border: none;
      border-radius: var(--radius);
      display: none;
      box-shadow: var(--shadow);
    }

    #status {
      margin-top: 24px;
      font-size: 1rem;
      color: var(--text);
    }

    .info-section {
      background: var(--card);
      padding: 32px;
      margin-top: 48px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      text-align: left;
      max-width: 820px;
    }

    .info-section h2 {
      font-family: "Playfair Display", serif;
      color: var(--heading);
      font-size: 1.6rem;
      margin-bottom: 16px;
    }

    .info-section ul {
      padding-left: 20px;
      font-size: 1rem;
      line-height: 1.6;
    }

    .info-section li {
      margin-bottom: 12px;
    }

    .loader {
      border: 4px solid rgba(255,255,255,0.15);
      border-top: 4px solid var(--accent);
      border-radius: 50%;
      width: 28px;
      height: 28px;
      animation: spin 0.9s linear infinite;
      display: inline-block;
      margin-right: 10px;
      vertical-align: middle;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #loading-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(11, 27, 28, 0.95);
      color: var(--text);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      text-align: center;
      padding: 20px;
    }

    #loading-overlay .loader {
      width: 48px;
      height: 48px;
      margin-bottom: 20px;
    }

    #loading-overlay p {
      font-size: 1.2rem;
      max-width: 300px;
      line-height: 1.6;
    }

    .language-toggle {
      margin-bottom: 24px;
    }
    
    .language-toggle button {
      background: var(--card);
      color: var(--text);
      border: 1px solid var(--accent);
      border-radius: 20px;
      padding: 8px 16px;
      margin: 0 6px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .language-toggle button:hover {
      background: var(--accent);
      color: var(--bg);
    }
    
    .language-toggle button.active {
      background: var(--accent);
      color: var(--bg);
      font-weight: 600;
    }
  </style>
</head>

<body>
  <div class="language-toggle">
    <button onclick="setLanguage('en')" class="active" id="en-btn">ğŸ‡¬ğŸ‡§ English</button>
    <button onclick="setLanguage('tr')" id="tr-btn">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</button>
  </div>

  <div id="loading-overlay">
    <div class="loader"></div>
    <p id="loading-text">Processing your payment...<br>Please wait a moment ğŸŒ‘ğŸŒ•</p>
  </div>

  <h1 id="title">Complete Your $9.99 Purchase</h1>
  <p id="instruction">Enter your name and email to proceed:</p>

  <form id="user-form" style="width: 100%; max-width: 400px;">
    <input type="text" id="user-name" placeholder="Your Name" required />
    <input type="email" id="user-email" placeholder="Your Email" required />
  </form>

  <div class="exchange-note" id="exchange-note">
    ğŸ’¬ Your card will be charged in Turkish Lira (â‚º), based on the latest exchange rates (approx. 1 USD â‰ˆ 38.43 TRY).
  </div>

  <button id="pay-button">ğŸ’³ Pay Securely via Form</button>
  <p style="margin: 10px 0;" id="or-text">or</p>

  <div id="status"></div>
  <iframe id="paytr-iframe" title="Secure PayTR Checkout"></iframe>

  <a href="https://www.paytr.com/link/PdWV9Ke?lang=en" target="_blank">
    <button class="link-button" id="direct-link-text">ğŸ”— Pay via Direct Link</button>
  </a>
  <p style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;" id="rate-fixed-note">
    We've fixed the exchange rate at <strong>1 USD = 39 TRY</strong> for this launch. If the exchange rate changes drastically, we'll update the price accordingly.
  </p>

  <img src="images/peoplen.png" alt="Welcome" class="hero-image" />

  <div class="info-section">
    <h2 id="payment-process-title">ğŸ“œ How the Payment Process Works</h2>
    <ul id="payment-process-steps">
      <li>Fill in your name and email.</li>
      <li>Click the secure payment button or use the direct link.</li>
      <li>Complete payment via PayTR's secure checkout.</li>
      <li>Get redirected to your access page instantly after success.</li>
    </ul>

    <h2 style="margin-top:32px;" id="install-title">ğŸ“± How to Install Cabinet of Selves as an App</h2>
    <ul id="install-steps">
      <li><strong>iPhone (Safari):</strong> Tap the <em>Share</em> icon and select <strong>"Add to Home Screen"</strong>.</li>
      <li><strong>Android (Chrome):</strong> Tap the three-dot menu, then choose <strong>"Install App"</strong>.</li>
      <li><strong>Desktop:</strong> Look for an <em>install</em> icon in the address bar or use browser settings.</li>
    </ul>

    <p style="margin-top:24px;font-size:0.95rem;color:#aaa;" id="app-store-note">
      ğŸ›¡ï¸ This app is not from an app store â€” it's a safe, private space developed independently.
    </p>
    <p style="margin-top:20px;font-size:0.95rem;color:#aaa;" id="help-note">
      ğŸ•¯ï¸ Questions or issues? We're always here to help.
    </p>
  </div>

  <script>
    const payButton = document.getElementById("pay-button");
    const iframe = document.getElementById("paytr-iframe");
    const status = document.getElementById("status");
    const loadingOverlay = document.getElementById("loading-overlay");

    // Language support
    const translations = {
      en: {
        title: "Complete Your $9.99 Purchase",
        instruction: "Enter your name and email to proceed:",
        exchangeNote: "ğŸ’¬ Your card will be charged in Turkish Lira (â‚º), based on the latest exchange rates (approx. 1 USD â‰ˆ 38.43 TRY).",
        rateFixedNote: "We've fixed the exchange rate at <strong>1 USD = 39 TRY</strong> for this launch. If the exchange rate changes drastically, we'll update the price accordingly.",
        orText: "or",
        directLinkText: "ğŸ”— Pay via Direct Link",
        paymentProcessTitle: "ğŸ“œ How the Payment Process Works",
        paymentProcessSteps: [
          "Fill in your name and email.",
          "Click the secure payment button or use the direct link.",
          "Complete payment via PayTR's secure checkout.",
          "Get redirected to your access page instantly after success."
        ],
        installTitle: "ğŸ“± How to Install Cabinet of Selves as an App",
        installSteps: [
          "<strong>iPhone (Safari):</strong> Tap the <em>Share</em> icon and select <strong>\"Add to Home Screen\"</strong>.",
          "<strong>Android (Chrome):</strong> Tap the three-dot menu, then choose <strong>\"Install App\"</strong>.",
          "<strong>Desktop:</strong> Look for an <em>install</em> icon in the address bar or use browser settings."
        ],
        appStoreNote: "ğŸ›¡ï¸ This app is not from an app store â€” it's a safe, private space developed independently.",
        helpNote: "ğŸ•¯ï¸ Questions or issues? We're always here to help.",
        loadingText: "Processing your payment...<br>Please wait a moment ğŸŒ‘ğŸŒ•",
        namePlaceholder: "Your Name",
        emailPlaceholder: "Your Email"
      },
      tr: {
        title: "$9.99'lÄ±k SatÄ±n Alma Ä°ÅŸleminizi TamamlayÄ±n",
        instruction: "Devam etmek iÃ§in adÄ±nÄ±zÄ± ve e-posta adresinizi girin:",
        exchangeNote: "ğŸ’¬ KartÄ±nÄ±z TÃ¼rk LirasÄ± (â‚º) Ã¼zerinden gÃ¼ncel kurla tahsil edilecektir (yaklaÅŸÄ±k 1 USD â‰ˆ 38.43 TL).",
        rateFixedNote: "Bu lansman iÃ§in dÃ¶viz kuru sabitlendi: <strong>1 USD = 39 TL</strong>. Kurda ciddi bir deÄŸiÅŸiklik olursa fiyat gÃ¼ncellenecektir.",
        orText: "veya",
        directLinkText: "ğŸ”— DoÄŸrudan BaÄŸlantÄ± ile Ã–de",
        paymentProcessTitle: "ğŸ“œ Ã–deme SÃ¼reci NasÄ±l Ä°ÅŸler",
        paymentProcessSteps: [
          "AdÄ±nÄ±zÄ± ve e-posta adresinizi girin.",
          "GÃ¼venli Ã¶deme butonuna tÄ±klayÄ±n veya doÄŸrudan baÄŸlantÄ±yÄ± kullanÄ±n.",
          "PayTR'nin gÃ¼venli Ã¶deme sayfasÄ±nda iÅŸlemi tamamlayÄ±n.",
          "BaÅŸarÄ±lÄ± Ã¶deme sonrasÄ± anÄ±nda eriÅŸim sayfanÄ±za yÃ¶nlendirileceksiniz."
        ],
        installTitle: "ğŸ“± Cabinet of Selves UygulamasÄ±nÄ± YÃ¼kleme",
        installSteps: [
          "<strong>iPhone (Safari):</strong> <em>PaylaÅŸ</em> simgesine dokunun ve <strong>\"Ana Ekrana Ekle\"</strong> seÃ§eneÄŸini seÃ§in.",
          "<strong>Android (Chrome):</strong> ÃœÃ§ nokta menÃ¼sÃ¼ne dokunun, ardÄ±ndan <strong>\"UygulamayÄ± YÃ¼kle\"</strong> seÃ§eneÄŸini seÃ§in.",
          "<strong>MasaÃ¼stÃ¼:</strong> Adres Ã§ubuÄŸundaki <em>yÃ¼kleme</em> simgesini arayÄ±n veya tarayÄ±cÄ± ayarlarÄ±nÄ± kullanÄ±n."
        ],
        appStoreNote: "ğŸ›¡ï¸ Bu uygulama bir uygulama maÄŸazasÄ±ndan deÄŸil â€” baÄŸÄ±msÄ±z olarak geliÅŸtirilmiÅŸ gÃ¼venli, Ã¶zel bir alandÄ±r.",
        helpNote: "ğŸ•¯ï¸ SorularÄ±nÄ±z veya sorunlarÄ±nÄ±z mÄ± var? Her zaman yardÄ±ma hazÄ±rÄ±z.",
        loadingText: "Ã–demeniz iÅŸleniyor...<br>LÃ¼tfen bir dakika bekleyin ğŸŒ‘ğŸŒ•",
        namePlaceholder: "AdÄ±nÄ±z",
        emailPlaceholder: "E-posta Adresiniz"
      }
    };

    function setLanguage(lang) {
      // Update button states
      document.getElementById('en-btn').classList.toggle('active', lang === 'en');
      document.getElementById('tr-btn').classList.toggle('active', lang === 'tr');
      
      // Update all text elements
      document.getElementById('title').textContent = translations[lang].title;
      document.getElementById('instruction').textContent = translations[lang].instruction;
      document.getElementById('exchange-note').textContent = translations[lang].exchangeNote;
      document.getElementById('rate-fixed-note').innerHTML = translations[lang].rateFixedNote;
      document.getElementById('or-text').textContent = translations[lang].orText;
      document.getElementById('direct-link-text').textContent = translations[lang].directLinkText;
      document.getElementById('payment-process-title').textContent = translations[lang].paymentProcessTitle;
      document.getElementById('install-title').textContent = translations[lang].installTitle;
      document.getElementById('app-store-note').textContent = translations[lang].appStoreNote;
      document.getElementById('help-note').textContent = translations[lang].helpNote;
      document.getElementById('loading-text').innerHTML = translations[lang].loadingText;
      document.getElementById('user-name').placeholder = translations[lang].namePlaceholder;
      document.getElementById('user-email').placeholder = translations[lang].emailPlaceholder;
      
      // Update lists
      const paymentSteps = translations[lang].paymentProcessSteps;
      const paymentListItems = document.querySelectorAll('#payment-process-steps li');
      paymentSteps.forEach((step, i) => {
        if (paymentListItems[i]) {
          paymentListItems[i].innerHTML = step;
        }
      });
      
      const installSteps = translations[lang].installSteps;
      const installListItems = document.querySelectorAll('#install-steps li');
      installSteps.forEach((step, i) => {
        if (installListItems[i]) {
          installListItems[i].innerHTML = step;
        }
      });
    }

    payButton.addEventListener("click", async () => {
      const name = document.getElementById("user-name").value.trim();
      const email = document.getElementById("user-email").value.trim();

      if (!name || !email) {
        status.textContent = document.getElementById('en-btn').classList.contains('active') ? 
          "âš ï¸ Please enter your name and email." : 
          "âš ï¸ LÃ¼tfen adÄ±nÄ±zÄ± ve e-posta adresinizi girin.";
        return;
      }

      iframe.style.display = "none";
      status.innerHTML = '<span class="loader"></span>' + 
        (document.getElementById('en-btn').classList.contains('active') ? 
         "Requesting secure payment link..." : 
         "GÃ¼venli Ã¶deme baÄŸlantÄ±sÄ± isteniyor...");

      try {
        loadingOverlay.style.display = "flex";

        const response = await fetch(
          "https://paymentintegration-production-a10d.up.railway.app/paytr-init",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              email,
              price: "9.99",
              user_name: name,
              user_address: "Imaginary Street No. 42, Istanbul",
              user_phone: "05555555555"
            })
          }
        );

        const data = await response.json();
        loadingOverlay.style.display = "none";

        if (data.token_url) {
          iframe.src = data.token_url;
          iframe.style.display = "block";
          status.textContent = document.getElementById('en-btn').classList.contains('active') ? 
            "âœ… Secure payment loaded. Please complete your transaction below." : 
            "âœ… GÃ¼venli Ã¶deme yÃ¼klendi. LÃ¼tfen iÅŸleminizi aÅŸaÄŸÄ±dan tamamlayÄ±n.";
        } else {
          status.textContent = document.getElementById('en-btn').classList.contains('active') ? 
            "âš ï¸ Failed to generate payment link." : 
            "âš ï¸ Ã–deme baÄŸlantÄ±sÄ± oluÅŸturulamadÄ±.";
          console.error("Error response:", data);
        }
      } catch (err) {
        loadingOverlay.style.display = "none";
        status.textContent = (document.getElementById('en-btn').classList.contains('active') ? 
          "ğŸš¨ Error: " : "ğŸš¨ Hata: ") + err.message;
        console.error("Request error:", err);
      }
    });
  </script>
</body>
</html>
