<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cabinet of Selves ‚Äì Secure Payment</title>

  <!-- Brand fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #0B1B1C;
      --card: #0F2124;
      --heading: #F5F4F2;
      --text: #C8CDD0;
      --accent: #D5A5C9;
      --accent-dark: #C48BB9;
      --radius: 12px;
      --shadow: 0 8px 22px rgba(0,0,0,0.45);
    }

    html, body {
      margin: 0;
      padding: 48px 24px;
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', system-ui, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      min-height: 100vh;
    }

    img.hero-image {
      width: 160px;
      height: auto;
      margin-bottom: 24px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    h1 {
      font-family: "Playfair Display", serif;
      color: var(--heading);
      font-size: 2.5rem;
      margin: 12px 0 24px;
    }

    p {
      font-size: 1.1rem;
      max-width: 700px;
      margin-bottom: 24px;
      line-height: 1.6;
    }

    .exchange-note {
      font-size: 0.9rem;
      color: #aaa;
      margin-bottom: 32px;
      max-width: 480px;
    }

    #pay-button {
      background: var(--accent);
      color: var(--bg);
      border: none;
      border-radius: var(--radius);
      padding: 16px 36px;
      font-size: 1.15rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: 0.3s all;
    }

    #pay-button:hover {
      background: var(--accent-dark);
      transform: translateY(-2px);
    }

    #paytr-iframe {
      margin-top: 36px;
      width: 100%;
      max-width: 820px;
      height: 620px;
      border: none;
      border-radius: var(--radius);
      display: none;
      box-shadow: var(--shadow);
    }

    #status {
      margin-top: 24px;
      font-size: 1rem;
      color: var(--text);
    }

    .info-section {
      background: var(--card);
      padding: 32px;
      margin-top: 48px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      text-align: left;
      max-width: 820px;
    }

    .info-section h2 {
      font-family: "Playfair Display", serif;
      color: var(--heading);
      font-size: 1.6rem;
      margin-bottom: 16px;
    }

    .info-section ul {
      padding-left: 20px;
      font-size: 1rem;
      line-height: 1.6;
    }

    .info-section li {
      margin-bottom: 12px;
    }

    .loader {
      border: 4px solid rgba(255,255,255,0.15);
      border-top: 4px solid var(--accent);
      border-radius: 50%;
      width: 28px;
      height: 28px;
      animation: spin 0.9s linear infinite;
      display: inline-block;
      margin-right: 10px;
      vertical-align: middle;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* üåü New: Full Page Loading Overlay */
    #loading-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(11, 27, 28, 0.95);
      color: var(--text);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      text-align: center;
      padding: 20px;
    }

    #loading-overlay .loader {
      width: 48px;
      height: 48px;
      margin-bottom: 20px;
    }

    #loading-overlay p {
      font-size: 1.2rem;
      max-width: 300px;
      line-height: 1.6;
    }
  </style>
</head>

<body>

  <div id="loading-overlay">
    <div class="loader"></div>
    <p>Processing your payment...<br>Please wait a moment üåëüåï</p>
  </div>

  <img src="images/peoplen.png" alt="Welcome" class="hero-image" />

  <h1>Complete Your $9.99 Purchase</h1>

  <p>
    Click the button below to open a secure checkout and finalize your access to the Cabinet of Selves.
  </p>

  <div class="exchange-note">
    üí¨ Your card will be charged in Turkish Lira (‚Ç∫), based on the latest exchange rates (approx. 1 USD ‚âà 38.43 TRY).
  </div>

  <button id="pay-button">üí≥ Pay $9.99</button>

  <div id="status"></div>
  <iframe id="paytr-iframe" title="Secure PayTR Checkout"></iframe>

  <div class="info-section">
    <h2>üìú How the Payment Process Works</h2>
    <ul>
      <li>Click the <strong>Pay $9.99</strong> button above.</li>
      <li>A secure payment window will open ‚Äî hosted directly by our trusted partner, PayTR.</li>
      <li>Enter your card details and complete the transaction.</li>
      <li>Upon successful payment, you will be redirected automatically to your access page.</li>
    </ul>

    <h2 style="margin-top:32px;">üì± How to Install Cabinet of Selves as an App</h2>
    <ul>
      <li><strong>iPhone (Safari):</strong> Tap the <em>Share</em> icon at the bottom and select <strong>"Add to Home Screen"</strong>.</li>
      <li><strong>Android (Chrome):</strong> Tap the three dots at the top right, then tap <strong>"Install App"</strong> or <strong>"Add to Home Screen"</strong>.</li>
      <li><strong>Desktop (Chrome/Edge):</strong> Look for the <em>Install</em> icon in the address bar or open browser settings to install as an app.</li>
    </ul>

    <p style="margin-top:24px;font-size:0.95rem;color:#aaa;">
      üõ°Ô∏è Some devices may display a security warning saying this app is "not from an App Store." This is perfectly normal ‚Äî Cabinet of Selves is an independent private space, and it's safe to proceed with installation.
    </p>

    <p style="margin-top:20px;font-size:0.95rem;color:#aaa;">
      üïØÔ∏è If you encounter any issues or need help, feel free to reach out to us anytime. We're always here for you.
    </p>
  </div>

  <script>
    const payButton = document.getElementById("pay-button");
    const iframe = document.getElementById("paytr-iframe");
    const status = document.getElementById("status");
    const loadingOverlay = document.getElementById("loading-overlay");

    payButton.addEventListener("click", async () => {
      iframe.style.display = "none";
      status.innerHTML = '<span class="loader"></span>Requesting secure payment link...';

      try {
        loadingOverlay.style.display = "flex";

        const response = await fetch(
          "https://paymentintegration-production-a10d.up.railway.app/paytr-init",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              email: "test@tempestlabs.space",
              price: "9.99",
              user_name: "Ilke",
              user_address: "Imaginary Street No. 42, Istanbul",
              user_phone: "05555555555"
            })
          }
        );

        const data = await response.json();
        loadingOverlay.style.display = "none";

        if (data.token_url) {
          iframe.src = data.token_url;
          iframe.style.display = "block";
          status.textContent = "‚úÖ Secure payment loaded. Please complete your transaction below.";
        } else {
          status.textContent = "‚ö†Ô∏è Failed to generate payment link.";
          console.error("Error response:", data);
        }
      } catch (err) {
        loadingOverlay.style.display = "none";
        status.textContent = "üö® Error: " + err.message;
        console.error("Request error:", err);
      }
    });
  </script>

</body>
</html>
